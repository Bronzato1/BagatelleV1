document.addEventListener("DOMContentLoaded",function(){"use strict";const v=document.querySelector("#fileButton"),r=document.querySelector("#fileInput"),j=document.querySelector("#fillTableButton"),b=document.querySelector("#processAllButton"),g=document.querySelector("#downloadFileButton"),m=document.querySelector("#resetButton"),n=document.querySelector("#optimiseButton"),a=document.querySelector("#progressBar"),i=0,l=1,f=2,u=3,z="#F11414",w="#39B642",F="#129885",M="#000000";var o=new JSZip,c=[],s=0,t=0,y=!0;v&&v.addEventListener("click",()=>{r.click()}),r&&r.addEventListener("change",e=>{}),j&&j.addEventListener("click",()=>{p().then(e=>{x(e)})}),b&&b.addEventListener("click",()=>{p().then(e=>{k(e)})}),g&&g.addEventListener("click",()=>{E()}),n&&n.addEventListener("click",()=>{const t="ion-ios-radio-button-off",e="ion-ios-radio-button-on";var o=n.innerHTML.includes("off")?t:e,s=n.innerHTML.includes("off")?e:t;n.innerHTML=n.innerHTML.replace(o,s),y=s==e}),m&&m.addEventListener("click",()=>{a.value=0,a.style.visibility="hidden",s=0,t=0,o=new JSZip;const e=document.querySelectorAll("#tableData tbody tr");e.length>0&&e.forEach(e=>e.remove());const n=document.querySelector("#tableData");n.style.display="none"});function _(e){const s=[];let t="",n=!1;e.split(`
`).forEach(e=>{n?t+=`
`+e:t=e;const o=(t.match(/"/g)||[]).length;n=o%2!==0,n||s.push(t)});const o=s.map(e=>C(e));return o}function C(e){const s=[];let t="",n=!1;return e.split(";").forEach(e=>{n?t+=";"+e:t=e;const o=(t.match(/"/g)||[]).length;n=o%2!==0,n||s.push(t.replaceAll('"',""))}),s}function O(e){const s=[];let t="",n=!1;return e.split(",").forEach(e=>{n?t+=","+e:t=e;const o=(t.match(/\[.*\]/)||[]).length;n=o==0,n||s.push(t.replace("[","").replace("]","").replace(":","#").trim())}),s.join(";")}function x(e){const s=document.querySelector("#tableData"),o=document.querySelector("#tableData tbody"),n=document.querySelectorAll("#tableData tbody tr");n.length>0&&n.forEach(e=>e.remove());const t=_(e);var i=t.slice(-1);i==""&&t.pop();for(let s=1;s<t.length;s++){const e=t[s],n=o.insertRow();console.log("Populate table for: "+e[0]);const i=n.insertCell();if(i.style="background-color: var(--background-color); border: none;",e[25]){const t=document.createElement("img");t.style="width: 40px; height: 40px; max-width: none; border-radius: 10px; object-fit: cover;",t.src=e[25],t.setAttribute("crossorigin","anonymous"),i.appendChild(t)}const a=n.insertCell();a.textContent=e[0];const r=n.insertCell();r.textContent=e[1];const c=n.insertCell();c.textContent=e[4];const l=n.insertCell();if(l.textContent=e[10],e[25]){const s=n.insertCell();s.style="background-color: var(--background-color); border: none;";const t=document.createElement("i");t.setAttribute("data-image-url",e[25]),t.classList.add("ion","ion-ios-checkmark-circle"),t.style="color: var(--tr-color); font-size: 20px;",s.appendChild(t)}}console.log(t.length-1+" éléments"),s.style.display=""}function D(e){const t=document.createElement("canvas");t.width=e.width,t.height=e.height;const n=t.getContext("2d");n.drawImage(e,0,0);const s=t.toDataURL("image/jpeg").split(";base64,")[1];return s}function e(e,n){const o=document.querySelector('i[data-image-url="'+n+'"]');o&&(o.style.color=e==l?w:e==i?z:e==f?F:e==u?M:"none"),a.value=parseInt(t/s*100)}function E(){o.generateAsync({type:"blob"}).then(function(e){let t=new Date,n=(t.getUTCMonth()+1).toString().padStart(2,"0"),o=t.getUTCDate().toString().padStart(2,"0"),i=t.getUTCFullYear().toString().padStart(4,"0"),a=t.getHours().toString().padStart(2,"0"),r=t.getMinutes().toString().padStart(2,"0");saveAs(e,`G-Maps-Extractor-${s}-${i}-${n}-${o}-${a}-${r}.zip`)})}async function k(n){const r=_(n);a.style.visibility="visible";var u,m=r.slice(-1);m==""&&r.pop(),s=r.length-1,t=1;for(t;t<=s;t++){const a=r[t],p=a[14].split(`
`),g=p.find(e=>e.substring(0,"facebook".length)==="facebook"),v=p.find(e=>e.substring(0,"twitter".length)==="twitter"),b=p.find(e=>e.substring(0,"instagram".length)==="instagram"),_=a[24],j=a[0].toLowerCase().replaceAll("œ","oe").replaceAll("’","-").replaceAll("'","-").replaceAll(" ","-").replaceAll("'","-").replaceAll("à","a").replaceAll("é","e").replaceAll("/","-").replaceAll(".","-").replaceAll("!","").replaceAll("?","").replaceAll("(","-").replaceAll(")","-").replaceAll("â","a").replaceAll("ô","o").replaceAll("û","u").replaceAll("ê","e").replaceAll("é","e").replaceAll("è","e").replaceAll("ç","c").replaceAll("&","-").replace(/-{2,}/g,"-").replace(/[-]$/,"");let n=[];if(n.push(`---`),n.push(`name: ${a[0]}`),n.push(`tag: ${a[4].toLowerCase()}`),n.push(`address: ${a[1]}`),n.push(`phone: ${a[10]}`),n.push(`mail: ${a[13]}`),n.push(`location: ${a[18]}`),n.push(`website: ${a[22]}`),g&&n.push(g),v&&n.push(v),b&&n.push(b),_){const e=O(a[24]);n.push(`schedule: '${e}'`)}n.push(`image: '0.jpg'`),n.push(`---`);const w=n.join(`
`),m=a[25];o.folder(`${j}`).file(`index.md`,w),y&&m?(await S(500),u=h(m).then(d).then(t=>{o.folder(`${j}`).file(`0.jpg`,t,{binary:!0}),e(l,m)}).catch(t=>{debugger;if(t.response&&t.response.status==429){console.error("Error:",t.message),e(i,m);const n=document.querySelector('i[data-image-url="'+m+'"]');n.onclick=()=>{A(a)}}else console.error("Error:",t.message),e(i,m)}),c.push(u)):e(f,null)}Promise.all(c).then(()=>{alert("finished")}).catch(e=>{console.error("An error occurred:",e)})}async function A(t){var s,n=t[25];e(u,n),s=h(n).then(d).then(s=>{debugger;var i=t[0].toLowerCase().replaceAll("'","-").replaceAll(" ","-").replaceAll("'","-").replaceAll("à","a").replaceAll("é","e").replaceAll("/","-").replaceAll(".","-").replaceAll("!","").replaceAll("?","").replaceAll("(","-").replaceAll(")","-").replaceAll("â","a").replaceAll("ô","o").replaceAll("û","u").replaceAll("ê","e").replaceAll("é","e").replaceAll("è","e").replaceAll("ç","c").replaceAll("&","-").replace(/-{2,}/g,"-").replace(/[-]$/,"");o.folder(`${i}`).file(`0.jpg`,s,{binary:!0}),e(l,n)}).catch(t=>{debugger;console.error("Error:",t.message),e(i,n)}),c.push(s)}async function S(e){return new Promise(t=>setTimeout(t,e))}async function p(){return new Promise(function(e){const o=document.getElementById("fileInput"),n=o.files[0];if(!n){alert("Please select a file.");return}const s=new FileReader;s.onload=function(t){e(t.target.result)},s.readAsText(n)})}async function d(e){return new Promise(function(t,n){JSZipUtils.getBinaryContent(e,function(e,s){e?n(e):t(s)})})}async function T(e){try{return axios.get(e,{responseType:"arraybuffer"}).then(e=>new Promise((t)=>{const i=e.data;let s="";const o=new Uint8Array(i),a=o.byteLength;for(let e=0;e<a;e++)s+=String.fromCharCode(o[e]);t(btoa(s))}))}catch(e){return console.error("Error:",e.message),null}}async function h(e){const t="https://corsproxy.io/?https://api.replicate.com/v1/predictions",o="r8_WsSrh8w9Qp9YQwahxuiNnbWnF47T8rj3ZQ9vx",i="42fed1c4974146d4d2414e2be2c5277c7fcf05fcc3a73abf41610695738c1d7b",a=document.querySelector("#progressLabel"),n={version:i,input:{image:"data:image/jpeg;base64,",scale:4,face_enhance:!1}},s={headers:{"x-cors-api-key":"temp_00e06d45fb9f69da4549e34586b971e9","Content-Type":"application/json",Authorization:`Token ${o}`}};return new Promise(function(o,i){T(e).then(e=>{e&&(n.input.image+=e,axios.post(t,n,s).then(e=>{console.log(e.data);function n(){console.log("Polling data...");var n=t+"/"+e.data.id;axios.get(n,s).then(e=>{console.log(e.data),e.data.status=="succeeded"&&(clearInterval(r),o(e.data.output))}).catch(e=>{debugger;console.error("Error:",e.message),i(e)})}const a=5e3,r=setInterval(n,a)}).catch(e=>{debugger;console.error("Error:",e.message),i(e)}))})})}}),String.prototype.endsWith=function(e){return this.indexOf(e,this.length-e.length)!==-1}