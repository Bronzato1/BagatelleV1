{{ $currentPage := .context }}
{{ $pages := default (slice) .pages }}

{{ with $currentPage }}
{{ range . }}
{{ if .IsPage }}
{{ $pages = $pages | append . }}
{{ end }}

{{ $subContext := .Pages }}
{{ with .Pages }}
{{ $subpages := partial "page-crawler" (dict "context" $subContext) }}
{{ $pages = $pages | append $subpages }}
{{ end }}
{{ end }}
{{ end }}

{{ return $pages }}
